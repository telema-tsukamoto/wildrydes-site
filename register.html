<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>WildRydes Registration</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="css/normalize.css">
    <link rel="stylesheet" href="css/index.css">

    <!-- AWS Amplify UMD版 -->
    <script src="https://cdn.jsdelivr.net/npm/aws-amplify@5.1.6/dist/aws-amplify.min.js"></script>
</head>
<body>
    <h1>Register</h1>
    <form id="registerForm">
        <input type="email" id="emailInput" placeholder="Email" required><br>
        <input type="password" id="passwordInput" placeholder="Password" required><br>
        <input type="password" id="passwordConfirmInput" placeholder="Confirm Password" required><br>
        <input type="submit" value="Register">
    </form>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        // UMD版では Amplify が window.Amplify として定義される
        Amplify.configure({
            Auth: {
                region: 'ap-southeast-2',
                userPoolId: 'ap-southeast-2_OuvpJbU5m',        // CLIで作成したプールID
                userPoolWebClientId: '4kppa7j77h6pegkf6fvp7d7hua' // CLIで作成したクライアントID
            }
        });

        const form = document.getElementById('registerForm');
        form.addEventListener('submit', async function(event) {
            event.preventDefault();

            const email = document.getElementById('emailInput').value.trim();
            const password = document.getElementById('passwordInput').value;
            const passwordConfirm = document.getElementById('passwordConfirmInput').value;

            if (password !== passwordConfirm) {
                alert("Passwords do not match!");
                return;
            }

            try {
                await Amplify.Auth.signUp({
                    username: email,      // Email を Username とする
                    password: password,
                    attributes: { email: email }
                });
                alert("Registration successful! Check your email for verification code.");
            } catch (err) {
                console.error(err);
                alert("Registration error: " + err.message);
            }
        });
    });
    </script>
</body>
</html>